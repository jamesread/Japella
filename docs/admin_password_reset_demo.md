#!/bin/bash

# Admin Password Reset Feature Demo
# This script demonstrates how to use the JAPELLA_RESET_ADMIN_PASSWORD environment variable

echo "=== Japella Admin Password Reset Feature Demo ==="
echo ""
echo "This feature allows you to reset the admin password to 'admin' by setting"
echo "the JAPELLA_RESET_ADMIN_PASSWORD environment variable to any value."
echo ""
echo "Usage examples:"
echo ""
echo "1. Reset admin password on startup:"
echo "   JAPELLA_RESET_ADMIN_PASSWORD=true ./japella"
echo ""
echo "2. Reset admin password with Docker:"
echo "   docker run -e JAPELLA_RESET_ADMIN_PASSWORD=true japella"
echo ""
echo "3. Reset admin password in systemd service:"
echo "   Environment=JAPELLA_RESET_ADMIN_PASSWORD=true"
echo ""
echo "4. Reset admin password in Kubernetes:"
echo "   env:"
echo "   - name: JAPELLA_RESET_ADMIN_PASSWORD"
echo "     value: \"true\""
echo ""
echo "How it works:"
echo "- The environment variable is checked during application startup"
echo "- If set to any value, the admin password is reset to 'admin'"
echo "- The reset happens before normal admin user initialization"
echo "- If admin user doesn't exist, it will be created with password 'admin'"
echo "- Logs will show the password reset operation"
echo ""
echo "Security considerations:"
echo "- This feature is intended for development and recovery scenarios"
echo "- The environment variable should be removed after use"
echo "- Consider using this feature only in secure environments"
echo "- The password 'admin' should be changed after first login"
echo ""
echo "Example log output when feature is used:"
echo "WARN[timestamp] JAPELLA_RESET_ADMIN_PASSWORD environment variable is set, resetting admin password to 'admin'"
echo "INFO[timestamp] Admin password successfully reset to 'admin'"
echo ""
echo "To test this feature:"
echo "1. Set the environment variable: export JAPELLA_RESET_ADMIN_PASSWORD=true"
echo "2. Start Japella: ./japella"
echo "3. Login with username: admin, password: admin"
echo "4. Change the password using the User Control Panel"
echo "5. Unset the environment variable: unset JAPELLA_RESET_ADMIN_PASSWORD"
echo ""
